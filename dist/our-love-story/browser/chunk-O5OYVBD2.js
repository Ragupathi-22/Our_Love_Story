import{la as S,na as c,oa as f}from"./chunk-S6UWFWRQ.js";import{l as m,o as p}from"./chunk-QOLEAA67.js";import{U as a,Z as n,g as l,m as v,n as g,r as o}from"./chunk-5KRWD2P7.js";import{a as h,b as d,f as b}from"./chunk-KT3CPUTC.js";var u=class t{loadingSubject=new l(!1);loading$=this.loadingSubject.asObservable();show(){this.loadingSubject.next(!0)}hide(){this.loadingSubject.next(!1)}static \u0275fac=function(r){return new(r||t)};static \u0275prov=a({token:t,factory:t.\u0275fac,providedIn:"root"})};var P=class t{constructor(e,r,i){this.auth=e;this.firestore=r;this.loadingService=i;p(this.auth).subscribe(s=>{this.currentUserSubject.next(s||null),s?this.loadUserProfile(s.uid):this.userProfileSubject.next(null)})}currentUserSubject=new l(null);userProfileSubject=new l(null);get currentUser$(){return this.currentUserSubject.asObservable()}get userProfile$(){return this.userProfileSubject.asObservable()}loadUserProfile(e){return b(this,null,function*(){try{this.loadingService.show();let r=c(this.firestore,"users",e),i=yield f(r);i.exists()?this.userProfileSubject.next(i.data()):this.userProfileSubject.next(null)}catch(r){console.error("Failed to load user profile:",r),this.userProfileSubject.next(null)}finally{this.loadingService.hide()}})}getUserProfileValue(){return this.userProfileSubject.value}getUid(){return this.auth.currentUser?.uid??null}getCurrentUserId(){return this.auth.currentUser?.uid||null}getUserProfile(){this.loadingService.show();let e=this.getCurrentUserId();if(!e)return this.loadingService.hide(),g(null);let r=c(this.firestore,"users",e);return v(f(r)).pipe(o(i=>{this.loadingService.hide();let s=i.data();return s?d(h({},s),{uid:e}):null}))}getTimeline(){return this.loadingService.show(),this.userProfile$.pipe(o(e=>(this.loadingService.hide(),e?.timeline??[])))}getGallery(){return this.loadingService.show(),this.userProfile$.pipe(o(e=>(this.loadingService.hide(),e?.gallery??[])))}getPlaylists(){return this.loadingService.show(),this.userProfile$.pipe(o(e=>(this.loadingService.hide(),e?.playlistUrl??[])))}getNoOfDays(){return this.loadingService.show(),this.userProfile$.pipe(o(e=>{this.loadingService.hide();let r=e?.loveStartDate;if(!r)return"0";let i=new Date(r),U=Math.abs(new Date().getTime()-i.getTime());return Math.ceil(U/(1e3*60*60*24)).toString()}))}static \u0275fac=function(r){return new(r||t)(n(m),n(S),n(u))};static \u0275prov=a({token:t,factory:t.\u0275fac,providedIn:"root"})};export{u as a,P as b};
